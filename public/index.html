<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChessLytics - Chess Wrapped 2024</title>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <!-- Background and Overlay -->
    <div id="background"></div>
    <div id="overlay"></div>

    <!-- Content Container -->
    <div id="contentContainer">
        <!-- Main Content -->
        <div style="max-width: 900px; padding: 16px; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 32px;">
            <!-- Image Above Title -->
            <img src="/static/gift2.png" alt="Chess Image" style="max-width: 180px; margin-bottom: -35px;">
            
            <!-- Title and Instructions -->
            <div style="text-align: center; color: #EEEED5; font-family: 'League Spartan', sans-serif; font-weight: 700; word-wrap: break-word; margin-top: 16px;">
                <div style="font-size: 54px; line-height: 54px;"> 
                    ChessLytics: Chess Wrapped 2024!
                </div>
                <div style="font-size: 30px; font-weight: 400; line-height: 30px; margin-top: 16px;"> 
                    Enter your Chess.com username:
                </div>
            </div>

            <!-- Input Section -->
            <div style="width: 100%; max-width: 580px; padding: 28px; background: #EEEED5; border-radius: 10px; display: flex; justify-content: center; align-items: center;">
                <input type="text" id="username" name="username" placeholder="e.g. EdwardL903" required style="width: 100%; max-width: 620px; height: 32px; font-family: 'League Spartan', sans-serif; font-size: 30px; text-align: center; color: #2D6056;">
            </div>

            <!-- Button Section -->
            <div style="width: 100%; max-width: 580px; padding: 28px; border-radius: 10px; border: 5px #EEEED5 solid; display: flex; justify-content: center; align-items: center;">
                <button id="submitBtn" style="width: 380px; height: 32px; font-family: 'League Spartan', sans-serif; font-weight: 700; font-size: 30px; text-align: center; color: #EEEED5; background: transparent; border: none; cursor: pointer;">
                    Generate Chess Analytics
                </button>
            </div>

            <!-- Loading Message and Result Section -->
            <div id="loadingMessage" style="display: none; font-family: 'League Spartan', sans-serif; font-weight: 700; text-align: center; font-size: 14px; color: white; margin-top: 10px;">
                Generating Chess Analytics...
            </div>
            <div class="result" id="result" style="display: none; margin-top: 24px; text-align: center; width: 100%; z-index: 10;">
                <!-- Dynamic Results Populated Here -->
            </div>
        </div>
    </div>





    <script>
    document.getElementById('submitBtn').addEventListener('click', function() {
    const username = document.getElementById('username').value;
    const loadingMessage = document.getElementById('loadingMessage');
    const submitBtn = document.getElementById('submitBtn');
    const resultContainer = document.getElementById('result');
    const contentContainer = document.getElementById('contentContainer');  // Reference to the content container
    

    if (!username) {
        alert('Please enter a username.');
        return;
    }

    // Show the loading message
    loadingMessage.style.display = 'block';
    submitBtn.disabled = true;

    // Clear the result container and hide it initially
    resultContainer.innerHTML = '';
    resultContainer.style.display = 'none';

    // Fetch data from the backend
    fetch('http://127.0.0.1:5000/generate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ username: username }),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Received data:', data); // Log the data to verify if it's correct
        console.log(data.highest);
        loadingMessage.style.display = 'none';  // Hide loading message
        submitBtn.disabled = false;

        if (data.total_time_spent) {
            // Show the result container
            console.log(data); // Check the structure of 'data'

            resultContainer.style.display = 'block';

            // Create a stats container to display analytics data
            const statsContainer = document.createElement('div');
            statsContainer.innerHTML = `
                <div class="analytics-container">
  <h2 class="section-title">Your Chess Analytics</h2>

  <div class="stat-block">
    <span class="stat-label">Total Time Spent:</span>
    <span class="stat-value">${data.total_time_spent.total_time}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Time (in days):</span>
    <span class="stat-value">${data.total_time_spent.total_time_in_days.toFixed(2)}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Time (in hours):</span>
    <span class="stat-value">${data.total_time_spent.total_time_in_hours.toFixed(2)}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Time (in minutes):</span>
    <span class="stat-value">${data.total_time_spent.total_time_in_minutes.toFixed(2)}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Time (in seconds):</span>
    <span class="stat-value">${data.total_time_spent.total_time_in_seconds}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Percentage of Year:</span>
    <span class="stat-value">${data.total_time_spent.percentage_of_year.toFixed(2)}%</span>
  </div>

  <div class="stat-block">
    <span class="stat-label">Total Games Played:</span>
    <span class="stat-value">${data.total_games}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Wins:</span>
    <span class="stat-value">${data.total_win_draw_loss.win}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Draws:</span>
    <span class="stat-value">${data.total_win_draw_loss.draw}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Losses:</span>
    <span class="stat-value">${data.total_win_draw_loss.lose}</span>
  </div>

  <div class="stat-block">
    <span class="stat-label">Total En Passant:</span>
    <span class="stat-value">${data.total_en_passant}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Promotions:</span>
    <span class="stat-value">${data.total_promotions}</span>
  </div>

  <div class="stat-block">
    <span class="stat-label">Longest Winning Streak:</span>
    <span class="stat-value">${data.longest_winning_streak}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Longest Losing Streak:</span>
    <span class="stat-value">${data.longest_losing_streak}</span>
  </div>

  <div class="stat-block">
    <span class="stat-label">Most Played Opponent:</span>
    <span class="stat-value">${data.most_played_opponent}</span>
  </div>

  <h3 class="section-title">Other Results</h3>
  <div class="stat-block">
    <span class="stat-label">Total Wins:</span>
    <span class="stat-value">${data.total_results.win}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Checkmated:</span>
    <span class="stat-value">${data.total_results.checkmated}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Resigned:</span>
    <span class="stat-value">${data.total_results.resigned}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Timeout:</span>
    <span class="stat-value">${data.total_results.timeout}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Abandoned:</span>
    <span class="stat-value">${data.total_results.abandoned}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Repetition:</span>
    <span class="stat-value">${data.total_results.repetition}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Time vs Insufficient:</span>
    <span class="stat-value">${data.total_results.timevsinsufficient}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Stalemate:</span>
    <span class="stat-value">${data.total_results.stalemate}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Insufficient Material:</span>
    <span class="stat-value">${data.total_results.insufficient}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Total Agreed:</span>
    <span class="stat-value">${data.total_results.agreed}</span>
  </div>

  <h3 class="section-title">Highest Rating</h3>
  <div class="stat-block">
    <span class="stat-label">Highest Rating Achieved:</span>
    <span class="stat-value">${data.highest_rating.rating}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Time Control:</span>
    <span class="stat-value">${data.highest_rating.time_control}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Achieved On:</span>
    <span class="stat-value">${data.highest_rating.date}</span>
  </div>

  <div class="stat-block">
    <span class="stat-label">Most Time Spent On A Single Day:</span>
    <span class="stat-value">${data.most_time_spent_day_dict.date}</span>
  </div>
  <div class="stat-block">
    <span class="stat-label">Time Spent:</span>
    <span class="stat-value">${data.most_time_spent_day_dict.time_spent}</span>
  </div>

  <h3 class="section-title">My Openings</h3>
    <div class="list-container">
    <div class="stat-block">
        <span class="stat-label">White Opening:</span>
        <span class="stat-value">${data.my_openings.white_opening}</span>
    </div>
    <div class="stat-block">
        <span class="stat-label">Black Opening:</span>
        <span class="stat-value">${data.my_openings.black_opening}</span>
    </div>
    </div>
</div>


                
   
                
            `;

            resultContainer.appendChild(statsContainer);

            // Hide the input and button sections
            /*contentContainer.querySelector('div:nth-child(0)').style.display = 'none';  // Hide the first div (image + title)*/
            /*contentContainer.querySelector('div:nth-child(2)').style.display = 'none';  // Hide the second div (input and button)*/
        } 
        /*if (data.images) {
            const imagesContainers = document.getElementById('result'); 
            imagesContainer.appendChild(imageGrid);
        }*/
        else if (data.error) {
            // Handle the error message
            resultContainer.innerHTML = `
                <p class="error">${data.error}</p>
            `;
            resultContainer.style.display = 'block';  // Show the result container even for error
        }
    })
    .catch(error => {
        loadingMessage.style.display = 'none';  // Hide loading message
        submitBtn.disabled = false;

        // Show error in the result container
        resultContainer.style.display = 'block';
        resultContainer.innerHTML = `
            <p class="error">Failed to fetch the data. Please try again later.</p>
        `;
    });

    document.getElementById('username').value = '';
});

    </script>
</body>
</html>
